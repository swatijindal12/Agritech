@startuml
title Agritech DB design

left to right direction
skinparam roundcorner 5
skinparam linetype ortho
skinparam shadowing false
skinparam handwritten false
skinparam class {
    BackgroundColor white
    ArrowColor #2688d4
    BorderColor #2688d4
}

!define primary_key(x) <b><color:green><&key></color> x</b>
!define foreign_key(x) <color:#aaaaaa><&key></color> **x**
!define mandatorycolumn(x) <color:black><&media-record></color> **x**
!define optionalcolumn(x)  <color:white><&media-record></color> x
!define table(x) entity x << (T, green) >>

table( user ) {
  primary_key( id ): UUID<<autogenerated>>
  mandatorycolumn( name ) : String
  mandatorycolumn( address ) : String
  mandatorycolumn( phone ) : Number
  mandatorycolumn( email ) : String
  mandatorycolumn( food_grain ) : Boolean
  mandatorycolumn( vegetable ) : Boolean
  mandatorycolumn( horticulture ) : Boolean
  mandatorycolumn( floriculture ) : Boolean 
  mandatorycolumn( exotic_crop ) : Boolean
  mandatorycolumn( role ) : String
  mandatorycolumn( is_verified ) : Boolean
  optionalcolumn( createdAt ) : Date
  optionalcolumn( updatedAt ) : Date
}

table( farmer ) {
  primary_key( id ): UUID<<autogenerated>>
  mandatorycolumn( name ) : String
  mandatorycolumn( phone ) : Number
  mandatorycolumn( image_url ) : String
  mandatorycolumn( pin ) : Number
  mandatorycolumn( address ) : String
  mandatorycolumn( email ) : String
  mandatorycolumn( education ) : String
  mandatorycolumn( rating ) : Number
  mandatorycolumn( farmer_pdf ) : Number
  optionalcolumn( createdAt ) : Date
  optionalcolumn( updatedAt ) : Date
}

table( stageFarmer ) {
  primary_key( id ): UUID<<autogenerated>>
  mandatorycolumn( file_name ) : String
  mandatorycolumn( name ) : String
  mandatorycolumn( phone ) : Number
  mandatorycolumn( image_url ) : String
  mandatorycolumn( pin ) : Number
  mandatorycolumn( address ) : String
  mandatorycolumn( email ) : String
  mandatorycolumn( education ) : String
  mandatorycolumn( rating ) : Number
  mandatorycolumn( approval_status ) : Boolean
  mandatorycolumn( stage_status ) : Boolean
  optionalcolumn( createdAt ) : Date
  optionalcolumn( updatedAt ) : Date
}

table( farm ) {
  primary_key( id ): UUID<<autogenerated>>
  foreign_key( farmer_id ): INTEGER <<FK>>
  mandatorycolumn( name ) : String
  mandatorycolumn( farm_nft_id ) : String
  mandatorycolumn( ipfs_url ): String
  mandatorycolumn( tx_hash ): String
  mandatorycolumn( address ) : String
  mandatorycolumn( image_url ) : String
  mandatorycolumn( video_url ) : String
  mandatorycolumn( pin ) : Number
  mandatorycolumn( location ) : String
  mandatorycolumn( farm_size ) : Number
  mandatorycolumn( food_grain ) : Boolean
  mandatorycolumn( vegetable ) : Boolean
  mandatorycolumn( horticulture ) : Boolean
  mandatorycolumn( floriculture ) : Boolean 
  mandatorycolumn( exotic_crop ) : Boolean
  mandatorycolumn( rating ) : Number
  optionalcolumn( createdAt ) : Date
  optionalcolumn( updatedAt ) : Date
}

table( stageFarm ) {
  primary_key( id ): UUID<<autogenerated>>
  foreign_key( farmerId ): INTEGER <<FK>>
  mandatorycolumn( file_name ) : String
  mandatorycolumn( name ) : String
  mandatorycolumn( farm_nft_id ) : String
  mandatorycolumn( ipfs_url ): String
  mandatorycolumn( tx_hash ): String
  mandatorycolumn( address ) : String
  mandatorycolumn( image_url ) : String
  mandatorycolumn( video_url ) : String
  mandatorycolumn( pin ) : Number
  mandatorycolumn( farmLocation ) : String
  mandatorycolumn( farm_size ) : Number
  mandatorycolumn( food_grain ) : Boolean
  mandatorycolumn( vegetable ) : Boolean
  mandatorycolumn( horticulture ) : Boolean
  mandatorycolumn( floriculture ) : Boolean 
  mandatorycolumn( exotic_crop ) : Boolean
  mandatorycolumn( approval_status ) : Boolean
  mandatorycolumn( stage_status ) : Boolean
  mandatorycolumn( rating ) : Number
  optionalcolumn( createdAt ) : Date
  optionalcolumn( updatedAt ) : Date
}

table( agreement ) {
  primary_key( id ): UUID<<autogenerated>>
  foreign_key( customer_id ): INTEGER <<FK>>
  mandatorycolumn( ipfs_url ): String
  mandatorycolumn( farmer_name ) : String
  mandatorycolumn( farm_id ) : String
  mandatorycolumn( address ) : String
  mandatorycolumn( start_date ) : Date
  mandatorycolumn( end_date ) : Date  
  mandatorycolumn( crop ) : String
  mandatorycolumn( area ) : String
  mandatorycolumn( price ) : Number
  mandatorycolumn( tx_hash ) : String
  mandatorycolumn( agreement_nft_id ) : String 
  mandatorycolumn( farm_nft_id ) : String   
  mandatorycolumn( sold_status ) : Boolean
  mandatorycolumn( agreementclose_status ) : Boolean
  optionalcolumn( createdAt ) : Date
  optionalcolumn( updatedAt ) : Date
}

table( stageAgreement ) {
  primary_key( id ): UUID<<autogenerated>>
  foreign_key( customerId ): INTEGER <<FK>>
  mandatorycolumn( file_name ) : String
  mandatorycolumn( ipfsHash ): String
  mandatorycolumn( farmerName ) : String
  mandatorycolumn( startDate ) : Date
  mandatorycolumn( endDate ) : Date  
  mandatorycolumn( quantity ) : Number
  mandatorycolumn( crop ) : String
  mandatorycolumn( price ) : String
  mandatorycolumn( agreementnftId ) : String  
  mandatorycolumn( soldStatus ) : Boolean
  mandatorycolumn( agreementclose_status ) : Boolean
  mandatorycolumn( approval_status ) : Boolean
  mandatorycolumn( stage_status ) : Boolean
  optionalcolumn( createdAt ) : Date
  optionalcolumn( updatedAt ) : Date
}

table( payment ) {
  primary_key( id ): UUID<<autogenerated>>
  foreign_key( order_id ): INTEGER <<FK>>
  mandatorycolumn( razorpay_payment_id ): String
  mandatorycolumn( razorpay_order_id ): String
  mandatorycolumn( razorpay_payment_signature ) : String
  mandatorycolumn( payment_status ) : Boolean
  optionalcolumn( createdAt ) : Date
  optionalcolumn( updatedAt ) : Date
}

table( audit ) {
  primary_key( _id ): UUID<<autogenerated>>
  foreign_key( user_id ): INTEGER <<FK>>
  mandatorycolumn( user_name ) : String
  mandatorycolumn( table_name ) : String
  mandatorycolumn( record_id ) : String
  mandatorycolumn( change_type ) : String
  mandatorycolumn( change_reason ) : String
  mandatorycolumn( old_value ) : String
  mandatorycolumn( new_value ) : String
  optionalcolumn( createdAt ) : Date
  optionalcolumn( updatedAt ) : Date
}

table( order ) {
  primary_key( _id ): UUID<<autogenerated>>
  foreign_key( customer_id ): INTEGER <<FK>>
  mandatorycolumn( razorpay_order_id ) : String
  mandatorycolumn( amount ) : Number
  mandatorycolumn( currency ) : String
  optionalcolumn( createdAt ) : Date
  optionalcolumn( updatedAt ) : Date
}

table( orderItem ) {
  primary_key( _id ): UUID<<autogenerated>>
  foreign_key( order_id ): INTEGER <<FK>>
  foreign_key( agreement_id ): INTEGER <<FK>>
  mandatorycolumn( price ) : Number
  mandatorycolumn( unit ) : Number
  optionalcolumn( createdAt ) : Date
  optionalcolumn( updatedAt ) : Date
}


map Symbol_and_Relation {
 |o-- => Zero or One
 ||-- => Exactly One	
 }o-- => Zero or Many
 }|-- => One or Many
}

farm }o--|| farmer
order ||--|{ orderItem
orderItem ||--|| agreement
order ||--|| user
order ||--|| payment
agreement }o--|| farm
audit ||--o| farm
audit ||--o| agreement
audit ||--o| farmer
stageFarm ||--o| farm
stageAgreement ||--o| agreement
stageFarmer ||--o| farmer
@enduml